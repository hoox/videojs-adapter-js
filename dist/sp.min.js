/**
 * @license MIT
 * youbora-videojs5-adapter 6.0.0-rc
 * Packed with youboralib 6.0.0-rc
 * Copyright NicePopleAtWork <http://nicepeopleatwork.com/>
 * @author Jordi Aguilar
 */
/**
 * @license MIT
 * youbora-videojs5-adapter 6.0.0-rc
 * Packed with youboralib 6.0.0-rc
 * Copyright NicePopleAtWork <http://nicepeopleatwork.com/>
 * @author Jordi Aguilar
 */
(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.youbora=e()}})(function(){var e,t,i;return function e(t,i,r){function n(a,o){if(!i[a]){if(!t[a]){var u=typeof require=="function"&&require;if(!o&&u)return u(a,!0);if(s)return s(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var d=i[a]={exports:{}};t[a][0].call(d.exports,function(e){var i=t[a][1][e];return n(i?i:e)},d,d.exports,e,t,i,r)}return i[a].exports}var s=typeof require=="function"&&require;for(var a=0;a<r.length;a++)n(r[a]);return n}({1:[function(e,t,i){t.exports={name:"youbora-videojs5-adapter",type:"adapter",tech:"js",author:"Jordi Aguilar",version:"6.0.0-rc",libVersion:"6.0.0-rc",built:"Wed Dec 28 2016",features:{buffer:"monitor",seek:"native",getters:["getPlayhead","getDuration","getBitrate","getThroughput","getRendition","getTitle","getResource"]}}},{}],2:[function(e,t,i){t.exports={name:"youboralib",type:"lib",tech:"js",author:"Jordi Aguilar",version:"6.0.0-rc",built:"Wed Dec 28 2016"}},{}],3:[function(e,t,i){var r=e("../emitter");var n=e("../log");var s=e("../version");var a=e("./playbackchronos");var o=e("./playbackflags");var u=e("./playheadmonitor");var h=r.extend({constructor:function(e){this.flags=new o;this.chronos=new a;this.monitor=null;this.plugin=null;this.player=null;if(typeof e==="string"){this.player=document.getElementById(e)}else{this.player=e}this.tag=this.player;this.registerListeners();n.notice("Adapter "+this.getVersion()+" with Lib "+s+" is ready.");this.emit(h.Event.READY)},registerListeners:function(){},unregisterListeners:function(){},dispose:function(){if(this.monitor)this.monitor.stop();this.fireStop();this.unregisterListeners();this.player=null;this.tag=null},monitorPlayhead:function(e,t,i){var r=0;if(e)r|=u.Type.BUFFER;if(t)r|=u.Type.SEEK;this.monitor=new u(this,r,i)},getPlayhead:function(){return null},getPlayrate:function(){return!this.flags.isPaused?1:0},getFramesPerSecond:function(){return null},getDroppedFrames:function(){return null},getDuration:function(){return null},getBitrate:function(){return null},getThroughput:function(){return null},getRendition:function(){return null},getTitle:function(){return null},getTitle2:function(){return null},getIsLive:function(){return null},getResource:function(){return null},getPlayerVersion:function(){return null},getPlayerName:function(){return null},getVersion:function(){return s+"-generic-js"},getPosition:function(){return null},fireStart:function(e){if(!this.flags.isStarted){this.flags.isStarted=true;this.chronos.total.start();this.chronos.join.start();this.emit(h.Event.START,{params:e})}},fireJoin:function(e){if(this.flags.isStarted&&!this.flags.isJoined){if(this.monitor)this.monitor.start();this.flags.isJoined=true;this.chronos.join.stop();this.emit(h.Event.JOIN,{params:e})}},firePause:function(e){if(this.flags.isJoined&&!this.flags.isPaused){this.flags.isPaused=true;this.chronos.pause.start();this.emit(h.Event.PAUSE,{params:e})}},fireResume:function(e){if(this.flags.isJoined&&this.flags.isPaused){this.flags.isPaused=false;this.chronos.pause.stop();if(this.monitor)this.monitor.skipNextTick();this.emit(h.Event.RESUME,{params:e})}},fireBufferBegin:function(e,t){if(this.flags.isJoined&&!this.flags.isBuffering){if(t&&this.flags.isSeeking){n.notice("Converting current buffer to seek");this.chronos.buffer=this.chronos.seek.clone();this.chronos.seek.reset();this.flags.isSeeking=false}else{this.chronos.buffer.start()}this.flags.isBuffering=true;this.emit(h.Event.BUFFER_BEGIN,{params:e})}},fireBufferEnd:function(e){if(this.flags.isJoined&&this.flags.isBuffering){this.flags.isBuffering=false;this.chronos.buffer.stop();if(this.monitor)this.monitor.skipNextTick();this.emit(h.Event.BUFFER_END,{params:e})}},fireSeekBegin:function(e,t){if(this.flags.isJoined&&!this.flags.isSeeking){if(t!==false&&this.flags.isBuffering){n.notice("Converting current buffer to seek");this.chronos.seek=this.chronos.buffer.clone();this.chronos.buffer.reset();this.flags.isBuffering=false}else{this.chronos.seek.start()}this.flags.isSeeking=true;this.emit(h.Event.SEEK_BEGIN,{params:e})}},fireSeekEnd:function(e){if(this.flags.isJoined&&this.flags.isSeeking){this.flags.isSeeking=false;this.chronos.seek.stop();if(this.monitor)this.monitor.skipNextTick();this.emit(h.Event.SEEK_END,{params:e})}},fireStop:function(e){if(this.flags.isStarted){if(this.monitor)this.monitor.stop();this.flags.isStarted=false;this.chronos.total.stop();this.emit(h.Event.STOP,{params:e})}},fireError:function(e,t,i,r){var n={};if(typeof e==="object"){n=e}else{n.errorCode=e||"PLAY_FAILURE";n.errorMsg=t||n.errorCode;n.errorMetadata=i;n.errorLevel=r||"error"}this.emit(h.Event.ERROR,{params:n})},fireFatalError:function(e,t,i){if(this.monitor)this.monitor.stop();this.fireError(e,t,i,"fatal");this.fireStop()}},{Event:{READY:"ready",START:"start",JOIN:"join",PAUSE:"pause",RESUME:"resume",SEEK_BEGIN:"seek-begin",SEEK_END:"seek-end",BUFFER_BEGIN:"buffer-begin",BUFFER_END:"buffer-end",ERROR:"error",FATAL_ERROR:"fatal-error",STOP:"stop"}});t.exports=h},{"../emitter":17,"../log":18,"../version":26,"./playbackchronos":4,"./playbackflags":5,"./playheadmonitor":6}],4:[function(e,t,i){var r=e("../object");var n=e("../chrono");var s=r.extend({constructor:function(){this.reset()},reset:function(){this.join=new n;this.seek=new n;this.pause=new n;this.buffer=new n;this.total=new n}});t.exports=s},{"../chrono":7,"../object":19}],5:[function(e,t,i){var r=e("../object");var n=r.extend({constructor:function(){this.reset()},reset:function(){this.isStarted=false;this.isJoined=false;this.isPaused=false;this.isSeeking=false;this.isBuffering=false}});t.exports=n},{"../object":19}],6:[function(e,t,i){var r=e("../object");var n=e("../timer");var s=e("../chrono");var a=r.extend({constructor:function(e,t,i){this._adapter=e;this._seekEnabled=t&a.Type.SEEK;this._bufferEnabled=t&a.Type.BUFFER;this._interval=i||800;this._chrono=new s;this._lastPlayhead=0;if(this._interval>0){this._timer=new n(this.progress.bind(this),this._interval)}},start:function(){this._timer.start()},stop:function(){if(this._timer)this._timer.stop()},skipNextTick:function(){this._lastPlayhead=0},progress:function(){var e=this._chrono.stop();this._chrono.start();var t=e*a.kBUFFER_THRESHOLD_RATIO;var i=e*a.kSEEK_THRESHOLD_RATIO;var r=this._getPlayhead();var n=Math.abs(this._lastPlayhead-r)*1e3;if(n<t){if(this._bufferEnabled&&this._lastPlayhead>0&&!this._adapter.flags.isPaused&&!this._adapter.flags.isSeeking){this._adapter.fireBufferBegin(null,false)}}else if(n>i){if(this._seekEnabled&&this._lastPlayhead>0){this._adapter.fireSeekBegin(null,false)}}else{if(this._seekEnabled){this._adapter.fireSeekEnd()}else if(this._bufferEnabled){this._adapter.fireBufferEnd()}}this._lastPlayhead=r},_getPlayhead:function(){return this._adapter.getPlayhead()}},{Type:{NONE:0,BUFFER:1,SEEK:2},kBUFFER_THRESHOLD_RATIO:.5,kSEEK_THRESHOLD_RATIO:2});t.exports=a},{"../chrono":7,"../object":19,"../timer":24}],7:[function(e,t,i){var r=e("./object");var n=r.extend({constructor:function(){this.reset()},reset:function(){this.startTime=0;this.stopTime=0;this.offset=0},getDeltaTime:function(e){var t=(new Date).getTime();if(this.startTime){if(e&&!this.stopTime){this.stopTime=t}return this.offset+(t-this.startTime)}else{return-1}},start:function(){this.startTime=(new Date).getTime();this.stopTime=0},stop:function(){this.stopTime=(new Date).getTime();return this.startTime?this.offset+(this.stopTime-this.startTime):-1},clone:function(){var e=new n;e.startTime=this.startTime;e.stopTime=this.stopTime;e.offset=this.offset;return e}});t.exports=n},{"./object":19}],8:[function(e,t,i){var r=e("../object");var n=e("../log");var s=e("./request");var a=e("./transform/transform");var o=r.extend({constructor:function(){this.transforms=[];this._requests=[]},sendRequest:function(e,t){if(e){if(typeof t==="function")e.on(s.Event.SUCCESS,t);this._registerRequest(e)}},buildRequest:function(e,t,i,r){i=i||{};var n=new s(e,t,i);if(typeof r==="function")n.on(s.Event.SUCCESS,r);this._registerRequest(n)},addTransform:function(e){if(e.parse&&e.isBlocking){this.transforms.push(e);e.on(a.Event.DONE,this._processRequests.bind(this))}else{n.warn(e+" is not a valid RequestTransform.")}},removeTransform:function(e){var t=this.transforms.indexOf(e);if(t!==-1){this.transforms.splice(t,1)}else{n.warn("Trying to remove unexisting Transform '"+e+"'.")}},_registerRequest:function(e){this._requests.push(e);this._processRequests()},_processRequests:function(){var e=this._requests;this._requests=[];var t=[];while(e.length){var i=e.shift();if(this._transform(i)){i.send()}else{t.push(i)}}while(t.length){this._requests.push(t.shift())}},_transform:function(e){var t=true;this.transforms.forEach(function(i){if(i.isBlocking(e)){t=false;return}else{i.parse(e)}});return t}});t.exports=o},{"../log":18,"../object":19,"./request":9,"./transform/transform":15}],9:[function(e,t,i){var r=e("../object");var n=e("../log");var s=r.extend({constructor:function(e,t,i,r){this.xhr=this.createXHR();this.host=e||"";this.service=t||"";this.params=i||{};this.options=Object.assign({method:"GET",requestHeaders:{},maxRetries:3,retryAfter:5e3,cache:false},r);this.retries=0;if(!this.options.cache){this.setParam("timemark",(new Date).getTime())}},createXHR:function(){try{if(XMLHttpRequest){return new XMLHttpRequest}else{return new ActiveXObject("Microsoft.XMLHTTP")}}catch(e){n.error(e);return{}}},getXHR:function(){return this.xhr},getUrl:function(){return this.host+this.service+this.getParamString()},on:function(e,t){this.xhr.addEventListener(e,t.bind(this,this));return this},off:function(e,t){this.xhr.removeEventListener(e,t);return this},getParamString:function(){try{var e="?";for(var t in this.params){var i=this.params[t];if(i!==null&&typeof i==="object"){e+=encodeURIComponent(t)+"="+encodeURIComponent(JSON.stringify(i))+"&"}else if(i!==null&&typeof i!=="undefined"&&i!==""){e+=encodeURIComponent(t)+"="+encodeURIComponent(i)+"&"}}return e.slice(0,-1)}catch(e){n.error(e);return""}},getParam:function(e){return this.params[e]},setParam:function(e,t){this.params[e]=t;return this},send:function(){try{this.xhr.open(this.options.method,this.getUrl(),true);if(this.options.requestHeaders){for(var e in this.options.requestHeaders){if(this.options.requestHeaders.hasOwnProperty(e)){this.xhr.setRequestHeader(e,this.options.requestHeaders[e])}}}if(this.options.retryAfter>0&&this.options.maxRetries>0){var t=function(){if(this.retries>=this.options.maxRetries){n.error('Aborting failed request "'+this.service+'". Max retries reached.')}else{n.warn('YBRequest "'+this.service+'" failed. Retry '+(this.retries+1)+" of "+this.options.maxRetries+" in "+this.options.retryAfter+"ms.");setTimeout(function(){this.retries+=1;this.send()}.bind(this),this.options.retryAfter)}};if(this.retries===0){this.on(s.Event.ERROR,t.bind(this))}}if(n.logLevel<=n.Level.VERBOSE){n.verbose("XHR Req: "+this.getUrl())}for(var i in s._globalListeners){s._globalListeners[i].forEach(function(e){this.on(i,e)}.bind(this))}return this.xhr.send()}catch(e){n.error(e)}}},{Event:{SUCCESS:"load",LOAD:"load",ERROR:"error",ABORT:"abort"},_globalListeners:{},onEvery:function(e,t){s._globalListeners[e]=s._globalListeners[e]||[];s._globalListeners[e].push(t)},offEvery:function(e,t){if(s._globalListeners[e]){var i=s._globalListeners[e].indexOf(t);if(i!==-1){s._globalListeners[e].splice(i,1)}}}});t.exports=s},{"../log":18,"../object":19}],10:[function(e,t,i){var r=e("../../emitter");var n=e("../../log");var s=e("../request");var a=r.extend({constructor:function(e){this._options=Object.assign({cdnName:null,parsers:[],requestHeaders:{},parseType:function(){return 0}},e);this._responses={}},done:function(){this.emit(a.Event.DONE)},addParser:function(e){this._options.parsers.push(e);return this},setCdnName:function(e){this._options.cdnName=e;return this},setRequestHeader:function(e,t){this._options.requestHeaders[e]=t;return this},setParseType:function(e){this._options.parseType=e;return this},getCdnName:function(){return this._cdnName},getNodeHost:function(){return this._cdnNodeHost},getNodeTypeString:function(){return this._cdnNodeTypeString},getNodeType:function(){return this._cdnNodeType},getResponses:function(){return this._responses},parse:function(e,t){this._responses=t||{};var i=JSON.stringify(this._options.requestHeaders);if(this._responses[i]){this._parseResponse(this._responses[i])}else{this._requestResponse(e)}},_requestResponse:function(e){var t=JSON.stringify(this._options.requestHeaders);var i=new s(e,null,null,{method:"HEAD",maxRetries:0,requestHeaders:this._options.requestHeaders});i.on(s.Event.SUCCESS,function(e){this._responses[t]=e.getXHR().getAllResponseHeaders();this._parseResponse(this._responses[t])}.bind(this));i.on(s.Event.ERROR,function(e){this.done()}.bind(this));i.send()},_parseResponse:function(e){this._options.parsers.forEach(function(t){e.split("\n").forEach(function(e){var i=e.indexOf(":");if(i!==-1){var r=e.slice(0,i);if(r===t.headerName){this._executeParser(t,e.slice(i+1))}}}.bind(this))}.bind(this));this.done()},_executeParser:function(e,t){try{var i=e.regex.exec(t.trim());if(i!==null){if(this._options.cdnName)this._cdnName=this._options.cdnName;switch(e.element){case"host":this._cdnNodeHost=i[1];break;case"type":this._cdnNodeTypeString=i[1];this._cdnNodeType=this._options.parseType(this._cdnNodeTypeString);break;case"host+type":this._cdnNodeHost=i[1];this._cdnNodeTypeString=i[2];this._cdnNodeType=this._options.parseType(this._cdnNodeTypeString);break;case"type+host":this._cdnNodeTypeString=i[1];this._cdnNodeType=this._options.parseType(this._cdnNodeTypeString);this._cdnNodeHost=i[2];break;case"name":this._cdnName=i[1].toUpperCase();break}}}catch(e){n.warn("CDN parsing for "+this._options.cdnName+" could not parse header value "+t)}}},{Event:{DONE:"done"},_cdns:{Level3:{cdnName:"LEVEL3",parsers:[{element:"host+type",headerName:"X-WR-DIAG",regex:/Host:(.+)\sType:(.+)/}],requestHeaders:{"X-WR-DIAG":"host"},parseType:function(e){switch(e){case"TCP_HIT":case"TCP_MEM_HIT":case"TCP_IMS_HIT":return 1;case"TCP_MISS":return 2;default:return 0}}},Cloudfront:{cdnName:"CLOUDFRT",parsers:[{element:"host",headerName:"X-Amz-Cf-Id",regex:/(.+)/},{element:"type",headerName:"X-Cache",regex:/(\S+)\s.+/}],parseType:function(e){switch(e){case"Hit":return 1;case"Miss":return 2;default:return 0}}},Akamai:{cdnName:"AKAMAI",parsers:[{element:"type+host",headerName:"X-Cache",regex:/(.+)\sfrom\s.+\(.+\/(.+)\).*/}],parseType:function(e){switch(e){case"TCP_HIT":return 1;case"TCP_MISS":return 2;default:return 0}}},Highwinds:{cdnName:"HIGHNEGR",parsers:[{element:"host+type",headerName:"X-HW",regex:/.+,[0-9]+\.(.+)\.(.+)/}],parseType:function(e){switch(e){case"c":case"x":return 1;default:return 2}}},Fastly:{cdnName:"FASTLY",parsers:[{element:"host",headerName:"X-Served-By",regex:/([^,\s]+)$/},{element:"type",headerName:"X-Cache",regex:/([^,\s]+)$/}],parseType:function(e){switch(e){case"HIT":return 1;case"MISS":return 2;default:return 0}}},Balancer:{parsers:[{element:"name",headerName:null,regex:/(.+)/}]}},setBalancerHeaderName:function(e){a._cdns.Balancer.parsers[0].headerName=e},create:function(e){if(a._cdns[e]){return new a(a._cdns[e])}else{n.warn("Tried to create an unexisting CdnParser named "+e)}},add:function(e,t){a._cdns[e]=t}});t.exports=a},{"../../emitter":17,"../../log":18,"../request":9}],11:[function(e,t,i){var r=e("./transform");var n=r.extend({_services:["/init","/start"],isBlocking:function(e){if(this._isBusy&&e!=null&&this._services.indexOf(e.service)!==-1){this.done()}return r.prototype.isBlocking.apply(this,arguments)}});t.exports=n},{"./transform":15}],12:[function(e,t,i){var r=e("../request");var n=e("../../emitter");var s=e("../../log");var a=n.extend({constructor:function(){this._realResource=null},done:function(){this.emit(a.Event.DONE)},parse:function(e,t){t=t||"";try{var i=/((\S*?)(\.m3u8|\.m3u|\.ts|\.mp4)(\?\S*|\n|\r|$))/i.exec(e)}catch(e){s.warn("Parse HLS Regex failed",e);this.done()}if(i!==null){var n=i[1].trim();var a=t.lastIndexOf("/");if(n.indexOf("http")!==0&&a!==-1){n=t.slice(0,a)+"/"+n}if(i[3]===".m3u8"||i[3]===".m3u"){var o=new r(n,null,null,{cache:true});o.on(r.Event.SUCCESS,function(e){this.parse(e.getXHR().responseText,i[2])}.bind(this));o.on(r.Event.ERROR,function(e){this.done()}.bind(this));o.send()}else{this._realResource=n;this.done()}}else{this.done()}},getResource:function(){return this._realResource}},{Event:{DONE:"done"}});t.exports=a},{"../../emitter":17,"../../log":18,"../request":9}],13:[function(e,t,i){var r=e("./transform");var n=r.extend({constructor:function(){this.done()},parse:function(e){this._cloneParam(e,"accountCode","system");this._cloneParam(e,"transactionCode","transcode");this._cloneParam(e,"username","user");this._cloneParam(e,"mediaResource","resource");this._cloneParam(e,"errorMsg","msg");if(e.service!=="/joinTime"){this._cloneParam(e,"playhead","time")}switch(e.service){case"/start":this._cloneParam(e,"mediaDuration","duration");break;case"/joinTime":this._cloneParam(e,"joinDuration","time");this._cloneParam(e,"playhead","eventTime");break;case"/seek":this._cloneParam(e,"seekDuration","duration");break;case"/bufferUnderrun":this._cloneParam(e,"bufferDuration","duration");break;case"/ping":for(var t in e.params.entities){e.params.entityType=t;e.params.entityValue=e.params.entities[t];break}break}},_cloneParam:function(e,t,i){e.params[i]=e.params[t]}});t.exports=n},{"./transform":15}],14:[function(e,t,i){var r=e("./transform");var n=e("./hlsparser");var s=e("./cdnparser");var a=e("../../log");var o=r.extend({constructor:function(e){o.__super__.constructor.apply(this,arguments);this._plugin=e;this._realResource=null;this._initResource=null;this._cdnName=null;this._cdnNodeHost=null;this._cdnNodeTypeString=null;this._cdnNodeType=null;this._responses={};this._isBusy=false},getResource:function(){return this._realResource||this._initResource},getCdnName:function(){return this._cdnName},getNodeHost:function(){return this._cdnNodeHost},getNodeTypeString:function(){return this._cdnNodeTypeString},getNodeType:function(){return this._cdnNodeType},init:function(e){if(!this._isBusy){this._isBusy=true;this._initResource=e;s.setBalancerHeaderName(this._cdnNameHeader);this._hlsEnabled=this._plugin.isParseHls();this._cdnEnabled=this._plugin.isParseCdnNode();this._cdnList=this._plugin.getParseCdnNodeList().slice();this._cdnNameHeader=this._plugin.getParseCdnNodeNameHeader();this._setTimeout();if(this._hlsEnabled){this._parseHLS()}else if(this._cdnEnabled){this._parseCDN()}else{this.done()}}},_setTimeout:function(){this._parseTimeout=setTimeout(function(){if(this._isBusy){this.done();a.warn("ResourceTransform has exceded the maximum execution time (3s) and will be aborted.")}}.bind(this),3e3)},_parseHLS:function(){var e=new n;e.on(n.Event.DONE,function(){this._realResource=this._hlsTransform.getResource();if(this._cdnEnabled){this._parseCDN()}else{this.done()}}.bind(this));e.parse(this._initResource)},_parseCDN:function(){if(this._cdnList.length>0){var e=this._cdnList.pop();if(this.getNodeHost())this.done();var t=s.create(e);if(t){t.on(s.Event.DONE,function(){this._responses=t.getResponses();this._cdnName=t.getCdnName();this._cdnNodeHost=t.getNodeHost();this._cdnNodeTypeString=t.getNodeTypeString();this._cdnNodeType=t.getNodeType();if(this.getNodeHost())this.done()}.bind(this));t.parse(this.getResource(),this._responses)}else{this._parseCDN()}}},parse:function(e){if(e.service==="/start"){var t=this._plugin.requestBuilder.lastSent;t.mediaResource=e.params.mediaResource=this.getResource();if(this._cdnEnabled){t.cdn=e.params.cdn=e.params.cdn||this.getCdnName();t.nodeHost=e.params.nodeHost=this.getNodeHost();t.nodeType=e.params.nodeType=this.getNodeType();t.nodeTypeString=e.params.nodeTypeString=this.getNodeTypeString();t.nodeTypeString=e.params.nodeTypeString}}}});t.exports=o},{"../../log":18,"./cdnparser":10,"./hlsparser":12,"./transform":15}],15:[function(e,t,i){var r=e("../../emitter");var n=r.extend({constructor:function(){this._isBusy=true},parse:function(e){},isBlocking:function(e){return this._isBusy},done:function(){this._isBusy=false;this.emit(n.Event.DONE)}},{Event:{DONE:"done"}});t.exports=n},{"../../emitter":17}],16:[function(e,t,i){var r=e("../request");var n=e("./transform");var s=e("../../log");var a=e("../../util");var o=n.extend({constructor:function(e){n.prototype.constructor.apply(this,arguments);this.response={};this._viewIndex=-1;var t="/data";var i={apiVersion:"v6,v7",outputformat:"jsonp"};i=e.requestBuilder.buildParams(i,t);if(i!==null){s.notice(t+" "+i.system);if(i.system==="nicetest"){s.error("No accountCode has been set. Please set your accountCode inside plugin's options.")}this._request=new r(e.getHost(),t,i)}},init:function(){this._request.on(r.Event.SUCCESS,this._receiveData.bind(this)).on(r.Event.ERROR,this._failedData.bind(this)).send()},_receiveData:function(e,t){try{var i=e.getXHR().response;var r=JSON.parse(i.slice(i.indexOf("(")+1,i.lastIndexOf(")")));this.response.host=a.addProtocol(r.q.h);this.response.code=r.q.c;this.response.pingTime=r.q.pt;this.done()}catch(e){s.error("Fastdata response is invalid.")}},_failedData:function(e,t){s.error("Fastdata request failed.")},nextView:function(){this._viewIndex+=1;return this.getViewCode()},getViewCode:function(){return this.response.code+"_"+this._viewIndex},parse:function(e){e.host=e.host||this.response.host;e.params.code=e.params.code||this.getViewCode();if(e.service==="/ping"||e.service==="/start"){e.params.pingTime=e.params.pingTime||this.response.pingTime}}});t.exports=o},{"../../log":18,"../../util":25,"../request":9,"./transform":15}],17:[function(e,t,i){var r=e("./object");var n=r.extend({on:function(e,t){this._listeners=this._listeners||{};if(typeof t==="function"){this._listeners[e]=this._listeners[e]||[];this._listeners[e].push(t);return this}},off:function(e,t){this._listeners=this._listeners||{};if(this._listeners[e]){var i=this._listeners[e].indexOf(t);if(i!==-1){this._listeners[e].splice(i,1)}}return this},emit:function(e,t){this._listeners=this._listeners||{};t=t||{};if(Array.isArray(this._listeners[e])){this._listeners[e].forEach(this._eachCallback.bind(this,e,t))}if(Array.isArray(this._listeners["*"])){this._listeners["*"].forEach(this._eachCallback.bind(this,e,t))}return this},_eachCallback:function(e,t,i){if(typeof i==="function"){i({type:e,data:t,target:this})}}});t.exports=n},{"./object":19}],18:[function(e,t,i){var r=e("./emitter");var n={_emitter:new r,on:function(){n._emitter.on.apply(n._emitter,arguments)},off:function(){n._emitter.off.apply(n._emitter,arguments)},emit:function(){n._emitter.emit.apply(n._emitter,arguments)},Level:{SILENT:6,ERROR:5,WARNING:4,NOTICE:3,DEBUG:2,VERBOSE:1},Event:{LOG:"log"},logLevel:5,plainLogs:false,report:function(e,t,i){if(console&&console.log){t=t||n.Level.NOTICE;i=i||"darkcyan";var r={5:"e",4:"w",3:"n",2:"d",1:"v"};var s=r[t];var a="[Youbora]"+n._getCurrentTime()+" "+s+":";this.emit("log",{level:t,msg:e,prefix:a});if(n.logLevel<=t){if(n.plainLogs||document.documentMode){n._plainReport(e,a)}else{var o;if(t===n.Level.ERROR&&console.error){o=console.error}else if(t===n.Level.WARNING&&console.warn){o=console.warn}else if(t===n.Level.DEBUG&&console.debug){o=console.debug}else{o=console.log}a="%c"+a;if(e instanceof Array){e.splice(0,0,a,"color: "+i);o.apply(console,e)}else{o.call(console,a,"color: "+i,e)}}}}},_getCurrentTime:function(){var e=new Date;var t=("0"+e.getDate()).slice(-2);var i=("0"+e.getMinutes()).slice(-2);var r=("0"+e.getSeconds()).slice(-2);var n=("00"+e.getMilliseconds()).slice(-3);return"["+t+":"+i+":"+r+"."+n+"]"},_plainReport:function(e,t){if(e instanceof Array){for(var i in e){n._plainReport(e[i],t)}}else{if(typeof e==="string"){console.log(t+" "+e)}else{console.log(t+" <next line>");console.log(e)}}},error:function(){n.report([].slice.call(arguments),n.Level.ERROR,"darkred")},warn:function(){n.report([].slice.call(arguments),n.Level.WARNING,"darkorange")},notice:function(){n.report([].slice.call(arguments),n.Level.NOTICE,"darkgreen")},debug:function(){n.report([].slice.call(arguments),n.Level.DEBUG,"indigo")},verbose:function(){n.report([].slice.call(arguments),n.Level.VERBOSE,"navy")},loadLevelFromUrl:function(){if(typeof window!=="undefined"&&window.location&&window.location.search){var e=/\?.*&*youbora-debug=(.+)/i.exec(window.location.search);if(e!==null){n.logLevel=e[1]}var t=/\?.*&*youbora-debug=plain/i.exec(window.location.search);if(t!==null){n.plainLogs=true}}}};t.exports=n},{"./emitter":17}],19:[function(e,t,i){var r=function(){};r.prototype={constructor:function(){}};r.extend=function(e,t){var i=this;var r;if(e&&Object.prototype.hasOwnProperty.call(e,"constructor")){r=e.constructor}else{r=function(){return i.apply(this,arguments)}}Object.assign(r,i,t);r.prototype=Object.create(i.prototype,{constructor:{value:r,enumerable:false,writable:true,configurable:true}});if(e)Object.assign(r.prototype,e);r.__super__=i.prototype;return r};t.exports=r},{}],20:[function(e,t,i){var r=e("../object");var n=e("../log");var s=r.extend({constructor:function(e){this["enabled"]=true;this["httpSecure"]=null;this["host"]="nqs.nice264.com";this["accountCode"]="nicetest";this["username"]=null;this["parse.Hls"]=false;this["parse.CdnNameHeader"]="x-cdn-forward";this["parse.CdnNode"]=false;this["parse.CdnNode.list"]=["Akamai","Cloudfront","Level3","Fastly","Highwinds"];this["network.ip"]=null;this["network.isp"]=null;this["network.connectionType"]=null;this["device.code"]=null;this["content.transactionCode"]=null;this["content.resource"]=null;this["content.isLive"]=null;this["content.title"]=null;this["content.title2"]=null;this["content.duration"]=null;this["content.fps"]=null;this["content.bitrate"]=null;this["content.throughput"]=null;this["content.rendition"]=null;this["content.cdn"]=null;this["content.metadata"]={};this["ad.metadata"]={};this["extraparam.1"]=null;this["extraparam.2"]=null;this["extraparam.3"]=null;this["extraparam.4"]=null;this["extraparam.5"]=null;this["extraparam.6"]=null;this["extraparam.7"]=null;this["extraparam.8"]=null;this["extraparam.9"]=null;this["extraparam.10"]=null;this.setOptions(e)},setOptions:function(e,t){try{t=t||this;if(typeof e!=="undefined"){for(var i in e){if(typeof t[i]==="object"&&t[i]!==null){this.setOptions(e[i],t[i])}else{t[i]=e[i]}}}}catch(e){n.error(e)}}});t.exports=s},{"../log":18,"../object":19}],21:[function(e,t,i){var r=e("../emitter");var n=e("../timer");var s=e("../log");var a=e("../util");var o=e("../chrono");var u=e("../version");var h=e("../comm/communication");var d=e("../comm/transform/flow");var l=e("../comm/transform/view");var c=e("../comm/transform/nqs6");var f=e("../comm/transform/resource");var p=e("./options");var g=e("./requestbuilder");var m=e("../adapter/adapter");var _=r.extend({constructor:function(e,t){this.isInitiated=false;this.isPreloading=false;this.preloadChrono=new o;this.initChrono=new o;this.options=new p(e);this._adapter=null;this._adsAdapter=null;this._ping=this._ping=new n(this._sendPing.bind(this),5e3);this.requestBuilder=new g(this);this.resourceTransform=new f(this);this.viewTransform=new l(this);this.viewTransform.on(l.Event.DONE,function(e){this._ping.interval=e.target.response.pingTime*1e3}.bind(this));if(t)this.setAdapter(t);this.viewTransform.init()},_reset:function(){this._stopPings();this.resourceTransform=new f(this);this.isInitiated=false;this.isPreloading=false;this.initChrono.reset();this.preloadChrono.reset()},setOptions:function(e){this.options.setOptions(e)},setAdapter:function(e){if(e.plugin){s.warn("Adapters can only be added to a single plugin")}else{this.removeAdapter();this._adapter=e;e.plugin=this;e.on(m.Event.START,this._startListener.bind(this));e.on(m.Event.JOIN,this._joinListener.bind(this));e.on(m.Event.PAUSE,this._pauseListener.bind(this));e.on(m.Event.RESUME,this._resumeListener.bind(this));e.on(m.Event.SEEK_BEGIN,this._seekBeginListener.bind(this));e.on(m.Event.SEEK_END,this._seekEndListener.bind(this));e.on(m.Event.BUFFER_BEGIN,this._bufferBeginListener.bind(this));e.on(m.Event.BUFFER_END,this._bufferEndListener.bind(this));e.on(m.Event.ERROR,this._errorListener.bind(this));e.on(m.Event.STOP,this._stopListener.bind(this))}},getAdapter:function(){return this._adapter},removeAdapter:function(){if(this._adapter){this._adapter.dispose();this._adapter.plugin=null;this._adapter.off(m.Event.START,this._startListener);this._adapter.off(m.Event.JOIN,this._joinListener);this._adapter.off(m.Event.PAUSE,this._pauseListener);this._adapter.off(m.Event.RESUME,this._resumeListener);this._adapter.off(m.Event.SEEK_BEGIN,this._seekBeginListener);this._adapter.off(m.Event.SEEK_END,this._seekEndListener);this._adapter.off(m.Event.BUFFER_BEGIN,this._bufferBeginListener);this._adapter.off(m.Event.BUFFER_END,this._bufferEndListener);this._adapter.off(m.Event.ERROR,this._errorListener);this._adapter.off(m.Event.STOP,this._stopListener);this._adapter=null}},setAdsAdapter:function(e){if(e.plugin){s.warn("Adapters can only be added to a single plugin")}else{this.removeAdsAdapter();e.plugin=this;this._adsAdapter=e;e.on(m.Event.START,this._adStartListener.bind(this));e.on(m.Event.JOIN,this._adJoinListener.bind(this));e.on(m.Event.PAUSE,this._adPauseListener.bind(this));e.on(m.Event.RESUME,this._adResumeListener.bind(this));e.on(m.Event.BUFFER_BEGIN,this._adBufferBeginListener.bind(this));e.on(m.Event.BUFFER_END,this._adBufferEndListener.bind(this));e.on(m.Event.STOP,this._adStopListener.bind(this))}},getAdsAdapter:function(){return this._adsAdapter},removeAdsAdapter:function(){if(this._adsAdapter){this._adsAdapter.dispose();this._adsAdapter.plugin=null;this._adsAdapter.off(m.Event.START,this._adStartListener);this._adsAdapter.off(m.Event.JOIN,this._adJoinListener);this._adsAdapter.off(m.Event.PAUSE,this._adPauseListener);this._adsAdapter.off(m.Event.RESUME,this._adResumeListener);this._adsAdapter.off(m.Event.BUFFER_BEGIN,this._adBufferBeginListener);this._adsAdapter.off(m.Event.BUFFER_END,this._adBufferEndListener);this._adsAdapter.off(m.Event.STOP,this._adStopListener);this._adsAdapter=null}},disable:function(){this.setOptions({enabled:false})},enable:function(){this.setOptions({enabled:true})},_send:function(e,t,i){i=this.requestBuilder.buildParams(i,t);this.requestBuilder.buildRequest(e,t,i)},_initComm:function(){this.resourceTransform.init(this.getResource());this._comm=new h;this._comm.addTransform(new d);this._comm.addTransform(this.viewTransform);this._comm.addTransform(this.resourceTransform);this._comm.addTransform(new c)},firePreloadBegin:function(){if(!this.isPreloading){this.isPreloading=true;this.preloadChrono.start()}},firePreloadEnd:function(){if(this.isPreloading){this.isPreloading=false;this.preloadChrono.stop()}},fireInit:function(e){if(!this.isInitiated){this.viewTransform.nextView();this._initComm();this._startPings();this.isInitiated=true;this.initChrono.start();e=e||{};this._send(_.Event.WILL_SEND_INIT,_.Service.INIT,e);s.notice(_.Service.INIT+" "+(e.title||e.mediaResource))}},_startListener:function(e){if(!this.isInitiated){this.viewTransform.nextView();this._initComm();this._startPings()}var t=e.data.params||{};this._send(_.Event.WILL_SEND_START,_.Service.START,t);s.notice(_.Service.START+" "+(t.title||t.mediaResource))},_joinListener:function(e){var t=e.data.params||{};this._send(_.Event.WILL_SEND_JOIN,_.Service.JOIN,t);s.notice(_.Service.JOIN+" "+t.joinDuration+"ms")},_pauseListener:function(e){if(this._adapter){if(this._adapter.flags.isBuffering||this._adapter.flags.isSeeking||this._adsAdapter&&this._adsAdapter.flags.isStarted){this._adapter.chronos.pause.reset()}}var t=e.data.params||{};this._send(_.Event.WILL_SEND_PAUSE,_.Service.PAUSE,t);s.notice(_.Service.PAUSE+" at "+t.playhead+"s");
},_resumeListener:function(e){var t=e.data.params||{};this._send(_.Event.WILL_SEND_RESUME,_.Service.RESUME,t);s.notice(_.Service.RESUME+" "+t.pauseDuration+"ms")},_seekBeginListener:function(e){if(this._adapter&&this._adapter.flags.isPaused)this._adapter.chronos.pause.reset();s.notice("Seek Begin")},_seekEndListener:function(e){var t=e.data.params||{};this._send(_.Event.WILL_SEND_SEEK,_.Service.SEEK,t);s.notice(_.Service.SEEK+" to "+t.playhead+" in "+t.seekDuration+"ms")},_bufferBeginListener:function(e){if(this._adapter&&this._adapter.flags.isPaused)this._adapter.chronos.pause.reset();s.notice("Buffer Begin")},_bufferEndListener:function(e){var t=e.data.params||{};this._send(_.Event.WILL_SEND_BUFFER,_.Service.BUFFER,t);s.notice(_.Service.BUFFER+" to "+t.playhead+" in "+t.bufferDuration+"ms")},_errorListener:function(e){if(!this._comm)this._initComm();var t=e.data.params||{};this._send(_.Event.WILL_SEND_ERROR,_.Service.ERROR,t);s.notice(_.Service.ERROR+" "+t.errorLevel+" "+t.errorCode);if(t.errorLevel==="fatal")this._reset()},_stopListener:function(e){var t=e.data.params||{};this._send(_.Event.WILL_SEND_STOP,_.Service.STOP,t);s.notice(_.Service.STOP+" at "+t.playhead+"s");this._reset()},_adStartListener:function(e){if(this._adapter){this._adapter.fireBufferEnd();this._adapter.fireSeekEnd();if(this._adapter.flags.isPaused)this._adapter.chronos.pause.reset()}var t=e.data.params||{};t.adNumber=this.requestBuilder.getAdNumber();this._send(_.Event.WILL_SEND_AD_START,_.Service.AD_START,t);s.notice(_.Service.AD_START+" at "+t.playhead+"s")},_adJoinListener:function(e){var t=e.data.params||{};t.adNumber=this.requestBuilder.getAdNumber();this._send(_.Event.WILL_SEND_AD_JOIN,_.Service.AD_JOIN,t);s.notice(_.Service.AD_JOIN+" "+t.adJoinDuration+"ms")},_adPauseListener:function(e){var t=e.data.params||{};t.adNumber=this.requestBuilder.getAdNumber();this._send(_.Event.WILL_SEND_AD_PAUSE,_.Service.AD_PAUSE,t);s.notice(_.Service.AD_PAUSE+" at "+t.adPlayhead+"s")},_adResumeListener:function(e){var t=e.data.params||{};t.adNumber=this.requestBuilder.getAdNumber();this._send(_.Event.WILL_SEND_AD_RESUME,_.Service.AD_RESUME,t);s.notice(_.Service.AD_RESUME+" "+t.adPauseDuration+"ms")},_adBufferBeginListener:function(e){s.notice("Ad Buffer Begin");if(this._adsAdapter&&this._adsAdapter.flags.isPaused){this._adsAdapter.chronos.pause.reset()}},_adBufferEndListener:function(e){var t=e.data.params||{};t.adNumber=this.requestBuilder.getAdNumber();this._send(_.Event.WILL_SEND_AD_BUFFER,_.Service.AD_BUFFER,t);s.notice(_.Service.AD_BUFFER+" "+t.adBufferDuration+"ms")},_adStopListener:function(e){var t=e.data.params||{};t.adNumber=this.requestBuilder.getAdNumber();this._send(_.Event.WILL_SEND_AD_STOP,_.Service.AD_STOP,t);s.notice(_.Service.AD_STOP+" at "+t.playhead+"s")},_startPings:function(){if(!this._ping.isRunning)this._ping.start()},_stopPings:function(){this._ping.stop()},_sendPing:function(e){var t={diffTime:e,entities:this.requestBuilder.getChangedEntities()};if(this._adapter){if(this._adapter.flags.isPaused){t=this.requestBuilder.fetchParams(t,["pauseDuration"])}else{t=this.requestBuilder.fetchParams(t,["bitrate","throughput","fps"]);if(this._adsAdapter&&this._adsAdapter.flags.isStarted){t=this.requestBuilder.fetchParams(t,["adBitrate"])}}if(this._adapter.flags.isBuffering){t=this.requestBuilder.fetchParams(t,["bufferDuration"])}if(this._adapter.flags.isSeeking){t=this.requestBuilder.fetchParams(t,["seekDuration"])}if(this._adsAdapter){if(this._adsAdapter.flags.isStarted){t=this.requestBuilder.fetchParams(t,["adPlayhead"])}if(this._adsAdapter.flags.isBuffering){t=this.requestBuilder.fetchParams(t,["adBufferDuration"])}}}this._send(_.Event.WILL_SEND_PING,_.Service.PING,t);s.verbose(_.Service.PING)},getHost:function(){return a.addProtocol(a.stripProtocol(this.options["host"]),this.options["httpSecure"])},isParseHls:function(){return this.options["parse.Hls"]},isParseCdnNode:function(){return this.options["parse.CdnNode"]},getParseCdnNodeList:function(){return this.options["parse.CdnNode.list"]},getParseCdnNodeNameHeader:function(){return this.options["parse.CdnNameHeader"]},getPlayhead:function(){var e=0;if(this._adapter){try{e=this._adapter.getPlayhead()}catch(e){s.warn("An error occurred while calling getPlayhead",e)}}return a.parseNumber(e,0)},getPlayrate:function(){var e=0;if(this._adapter){try{e=this._adapter.getPlayrate()}catch(e){s.warn("An error occured while calling getPlayrate",e)}}return e},getFramesPerSecond:function(){var e=null;if(this._adapter){try{e=this._adapter.getFramesPerSecond()}catch(e){s.warn("An error occured while calling getFramesPerSecond",e)}}return e},getDroppedFrames:function(){var e=null;if(this._adapter){try{e=this._adapter.getDroppedFrames()}catch(e){s.warn("An error occured while calling getDroppedFrames",e)}}if(!e){e=this.getWebkitDroppedFrames()}return a.parseNumber(e,0)},getWebkitDroppedFrames:function(){if(this._adapter&&this._adapter.tag&&this._adapter.tag.webkitDroppedFrameCount){return this._adapter.tag.webkitDroppedFrameCount}return null},getDuration:function(){var e=this.options["content.duration"];if(e===null&&this._adapter){try{e=this._adapter.getDuration()}catch(e){s.warn("An error occured while calling getDuration",e)}}return a.parseNumber(Math.round(e),0)},getBitrate:function(){var e=this.options["content.bitrate"];if(e===null&&this._adapter){try{e=this._adapter.getBitrate()}catch(e){s.warn("An error occured while calling getBitrate",e)}if(!e||e===-1){e=this.getWebkitBitrate()}}return a.parseNumber(e,-1)},getWebkitBitrate:function(){if(this._adapter&&this._adapter.tag&&this._adapter.tag.webkitVideoDecodedByteCount){var e=this._adapter.tag.webkitVideoDecodedByteCount;if(this._lastWebkitBitrate){var t=this._adapter.tag.webkitVideoDecodedByteCount-this._lastWebkitBitrate;e=Math.round(t/this.viewTransform.response.pingTime*8)}this._lastWebkitBitrate=this._adapter.tag.webkitVideoDecodedByteCount;return e!==0?e:-1}},getThroughput:function(){var e=this.options["content.throughput"];if(e===null&&this._adapter){try{e=this._adapter.getThroughput()}catch(e){s.warn("An error occured while calling getThroughput",e)}}return a.parseNumber(e,-1)},getRendition:function(){var e=this.options["content.rendition"];if(e===null&&this._adapter){try{e=this._adapter.getRendition()}catch(e){s.warn("An error occured while calling getRendition",e)}}return e},getTitle:function(){var e=this.options["content.title"];if(e===null&&this._adapter){try{e=this._adapter.getTitle()}catch(e){s.warn("An error occured while calling getTitle",e)}}return e},getTitle2:function(){var e=this.options["content.title2"];if(e===null&&this._adapter){try{e=this._adapter.getTitle2()}catch(e){s.warn("An error occured while calling getTitle2",e)}}return e},getIsLive:function(){var e=this.options["content.isLive"];if(e===null&&this._adapter){try{e=this._adapter.getIsLive()}catch(e){s.warn("An error occured while calling getIsLive",e)}}return e||false},getResource:function(){var e=null;if(!this.resourceTransform.isBlocking()){e=this.resourceTransform.getResource()}return e||this.getOriginalResource()},getOriginalResource:function(){var e=null;e=this.options["content.resource"];if(e===null&&this._adapter){try{e=this._adapter.getResource()}catch(t){s.warn("An error occured while calling getResource",t);e=null}}return e||"unknown"},getTransactionCode:function(){return this.options["content.transactionCode"]},getMetadata:function(){return this.options["content.metadata"]},getPlayerVersion:function(){var e="";if(this._adapter){try{e=this._adapter.getPlayerVersion()}catch(e){s.warn("An error occured while calling getPlayerVersion",e)}}return e},getPlayerName:function(){var e="";if(this._adapter){try{e=this._adapter.getPlayerName()}catch(e){s.warn("An error occured while calling getPlayerName",e)}}return e},getCdn:function(){var e=null;if(!this.resourceTransform.isBlocking()){e=this.resourceTransform.getCdnName()}return e||this.options["content.cdn"]},getPluginVersion:function(){var e=u+"-adapterless";if(this._adapter){try{e=this._adapter.getVersion()}catch(e){s.warn("An error occured while calling getPluginVersion",e)}}return e},getExtraparam1:function(){return this.options["extraparam.1"]},getExtraparam2:function(){return this.options["extraparam.2"]},getExtraparam3:function(){return this.options["extraparam.3"]},getExtraparam4:function(){return this.options["extraparam.4"]},getExtraparam5:function(){return this.options["extraparam.5"]},getExtraparam6:function(){return this.options["extraparam.6"]},getExtraparam7:function(){return this.options["extraparam.7"]},getExtraparam8:function(){return this.options["extraparam.8"]},getExtraparam9:function(){return this.options["extraparam.9"]},getExtraparam10:function(){return this.options["extraparam.10"]},getAdPosition:function(){var e=null;if(this._adsAdapter){try{e=this._adsAdapter.getPosition()}catch(e){s.warn("An error occured while calling getAdPosition",e)}}return e},getAdPlayhead:function(){var e=null;if(this._adsAdapter){try{e=this._adsAdapter.getPlayhead()}catch(e){s.warn("An error occured while calling getAdPlayhead",e)}}return a.parseNumber(e,0)},getAdDuration:function(){var e=null;if(this._adsAdapter){try{e=this._adsAdapter.getDuration()}catch(e){s.warn("An error occured while calling getAdDuration",e)}}return a.parseNumber(e,0)},getAdBitrate:function(){var e=null;if(this._adsAdapter){try{e=this._adsAdapter.getBitrate()}catch(e){s.warn("An error occured while calling getAdBitrate",e)}if(!e||e===-1){e=this.getWebkitAdBitrate()}}return a.parseNumber(e,-1)},getWebkitAdBitrate:function(){if(this._adapter&&this._adapter.tag&&this._adapter.tag.webkitVideoDecodedByteCount){var e=this._adapter.tag.webkitVideoDecodedByteCount;if(this._lastWebkitAdBitrate){var t=this._adapter.tag.webkitVideoDecodedByteCount-this._lastWebkitAdBitrate;e=Math.round(t/this.viewTransform.response.pingTime*8)}this._lastWebkitAdBitrate=this._adapter.tag.webkitVideoDecodedByteCount;return e!==0?e:-1}},getAdTitle:function(){var e=null;if(this._adsAdapter){try{e=this._adsAdapter.getTitle()}catch(e){s.warn("An error occured while calling getAdTitle",e)}}return e},getAdResource:function(){var e=null;if(this._adsAdapter){try{e=this._adsAdapter.getResource()}catch(e){s.warn("An error occured while calling getAdResource",e)}}return e},getAdPlayerVersion:function(){var e=null;if(this._adsAdapter){try{e=this._adsAdapter.getPlayerVersion()}catch(e){s.warn("An error occured while calling getAdPlayerVersion",e)}}return e},getAdMetadata:function(){return this.options["ad.metadata"]},getPluginInfo:function(){var e={lib:u,adapter:this.getPluginVersion(),adAdapter:this._adsAdapter?this._adsAdapter.getVersion():null};return e},getIp:function(){return this.options["network.ip"]},getIsp:function(){return this.options["network.isp"]},getConnectionType:function(){return this.options["network.connectionType"]},getDeviceCode:function(){return this.options["device.code"]},getAccountCode:function(){return this.options["accountCode"]},getUsername:function(){return this.options["username"]},getReferer:function(){var e="";if(typeof window!=="undefined"&&window.location){e=window.location.href}return e},getNodeHost:function(){return this.resourceTransform.getNodeHost()},getNodeType:function(){return this.resourceTransform.getNodeType()},getNodeTypeString:function(){return this.resourceTransform.getNodeTypeString()},getPreloadDuration:function(){return this.preloadChrono.getDeltaTime(false)},getInitDuration:function(){return this.initChrono.getDeltaTime(false)},getJoinDuration:function(){if(this.isInitiated)return this.getInitDuration();return this._adapter?this._adapter.chronos.join.getDeltaTime(false):-1},getBufferDuration:function(){return this._adapter?this._adapter.chronos.buffer.getDeltaTime(false):-1},getSeekDuration:function(){return this._adapter?this._adapter.chronos.seek.getDeltaTime(false):-1},getPauseDuration:function(){return this._adapter?this._adapter.chronos.pause.getDeltaTime(false):-1},getAdJoinDuration:function(){return this._adsAdapter?this._adsAdapter.chronos.join.getDeltaTime(false):-1},getAdBufferDuration:function(){return this._adsAdapter?this._adsAdapter.chronos.buffer.getDeltaTime(false):-1},getAdPauseDuration:function(){return this._adsAdapter?this._adsAdapter.chronos.pause.getDeltaTime(false):-1},getTotalAdDuration:function(){return this._adsAdapter?this._adsAdapter.chronos.total.getDeltaTime(false):-1}},{Service:{DATA:"/data",INIT:"/init",START:"/start",JOIN:"/joinTime",PAUSE:"/pause",RESUME:"/resume",SEEK:"/seek",BUFFER:"/bufferUnderrun",ERROR:"/error",STOP:"/stop",PING:"/ping",AD_START:"/adStart",AD_JOIN:"/adJoin",AD_PAUSE:"/adPause",AD_RESUME:"/adResume",AD_BUFFER:"/adBufferUnerrun",AD_STOP:"/adStop"},Event:{WILL_SEND_START:"will-send-start",WILL_SEND_JOIN:"will-send-join",WILL_SEND_PAUSE:"will-send-pause",WILL_SEND_RESUME:"will-send-resume",WILL_SEND_SEEK:"will-send-seek",WILL_SEND_BUFFER:"will-send-buffer",WILL_SEND_ERROR:"will-send-error",WILL_SEND_FATAL_ERROR:"will-send-fatal-error",WILL_SEND_STOP:"will-send-stop",WILL_SEND_PING:"will-send-ping",WILL_SEND_AD_START:"will-send-ad-start",WILL_SEND_AD_JOIN:"will-send-ad-join",WILL_SEND_AD_PAUSE:"will-send-ad-pause",WILL_SEND_AD_RESUME:"will-send-ad-resume",WILL_SEND_AD_BUFFER:"will-send-ad-buffer",WILL_SEND_AD_STOP:"will-send-ad-stop"}});t.exports=_},{"../adapter/adapter":3,"../chrono":7,"../comm/communication":8,"../comm/transform/flow":11,"../comm/transform/nqs6":13,"../comm/transform/resource":14,"../comm/transform/view":16,"../emitter":17,"../log":18,"../timer":24,"../util":25,"../version":26,"./options":20,"./requestbuilder":22}],22:[function(e,t,i){var r=e("../object");var n=e("../log");var s=e("../comm/request");var a=["accountCode","username","rendition","title","title2","live","mediaDuration","mediaResource","transactionCode","properties","cdn","playerVersion","param1","param2","param3","param4","param5","param6","param7","param8","param9","param10","pluginVersion","pluginInfo","isp","connectionType","ip","deviceCode","preloadDuration"];var o=r.extend({constructor:function(e){this._plugin=e;this._adNumber=0;this.lastSent={}},fetchParams:function(e,t,i){e=e||{};t=t||[];for(var r=0;r<t.length;r++){var s=t[r];if(e[s]){return}var a=o.getters[s];if(this._plugin[a]){var u=this._plugin[a]();if(u!==null&&(!i||this.lastSent[s]!==u)){e[s]=u;this.lastSent[s]=u}}else{n.warn("Trying to call undefined getter "+s+":"+a)}}return e},buildParams:function(e,t){e=e||{};this.fetchParams(e,o.params[t],false);this.fetchParams(e,o.differentParams[t],true);return e},buildRequest:function(e,t,i){var r={params:i,plugin:this._plugin,adapter:this._plugin.getAdapter(),adsAdapter:this._plugin.getAdsAdapter()};this._plugin.emit(e,r);if(this._plugin._comm&&i!==null&&this._plugin.options.enabled){this._plugin._comm.sendRequest(new s(null,t,i))}},getAdNumber:function(){var e=this.lastSent.adNumber;if(e&&this.lastSent.adPosition===this._plugin.getAdPosition()){e+=1}else{e=1}this.lastSent.adNumber=e;return e},getChangedEntities:function(){return this.fetchParams({},o.differentParams["entities"],true)}},{params:{"/data":["system","pluginVersion"],"/init":a,"/start":a,"/joinTime":["joinDuration","playhead"],"/pause":["playhead"],"/resume":["pauseDuration","playhead"],"/seek":["seekDuration","playhead"],"/bufferUnderrun":["bufferDuration","playhead"],"/error":["player"].concat(a),"/stop":["bitrate","playhead"],"/adStart":["playhead","adTitle","adPosition","adDuration","adResource","adPlayerVersion","adProperties","adnalyzerVersion"],"/adJoin":["adPosition","joinAdDuration","adPlayhead"],"/adPause":["adPosition","adPlayhead"],"/adResume":["adPosition","adPlayhead","adPauseDuration"],"/adBufferUnerrun":["adPosition","adPlayhead","adBufferDuration"],"/adStop":["adPosition","adPlayhead","adBitrate","totalAdDuration"],"/ping":["playhead","droppedFrames","playrate"]},differentParams:{"/join":["title","title2","live","mediaDuration","mediaResource"],"/adJoin":["adTitle","adDuration","adResource"],entities:["rendition","title","title2","live","mediaDuration","mediaResource","param1","param2","param3","param4","param5","param6","param7","param8","param9","param10","adTitle","connectionType","deviceCode","ip","username","cdn","nodeHost","nodeType","nodeTypeString"]},getters:{playhead:"getPlayhead",playrate:"getPlayrate",fps:"getFramesPerSecond",droppedFrames:"getDroppedFrames",mediaDuration:"getDuration",bitrate:"getBitrate",throughput:"getThroughput",rendition:"getRendition",title:"getTitle",title2:"getTitle2",live:"getIsLive",mediaResource:"getResource",transactionCode:"getTransactionCode",properties:"getMetadata",playerVersion:"getPlayerVersion",player:"getPlayerName",cdn:"getCdn",pluginVersion:"getPluginVersion",param1:"getExtraparam1",param2:"getExtraparam2",param3:"getExtraparam3",param4:"getExtraparam4",param5:"getExtraparam5",param6:"getExtraparam6",param7:"getExtraparam7",param8:"getExtraparam8",param9:"getExtraparam9",param10:"getExtraparam10",adPosition:"getAdPosition",adPlayhead:"getAdPlayhead",adDuration:"getAdDuration",adBitrate:"getAdBitrate",adTitle:"getAdTitle",adResource:"getAdResource",adPlayerVersion:"getAdPlayerVersion",adProperties:"getAdMetadata",adnalyzerVersion:"getAdnalyzerVersion",pluginInfo:"getPluginInfo",isp:"getIsp",connectionType:"getConnectionType",ip:"getIp",deviceCode:"getDeviceCode",system:"getAccountCode",accountCode:"getAccountCode",username:"getUsername",joinDuration:"getJoinDuration",bufferDuration:"getBufferDuration",seekDuration:"getSeekDuration",pauseDuration:"getPauseDuration",adJoinDuration:"getAdJoinDuration",adBufferDuration:"getAdBufferDuration",totalAdDuration:"getTotalAdDuration",preloadDuration:"getPreloadDuration",adPauseDuration:"getAdPauseDuration",referer:"getReferer",nodeHost:"getNodeHost",nodeType:"getNodeType",nodeTypeString:"getNodeTypeString"}});t.exports=o},{"../comm/request":9,"../log":18,"../object":19}],23:[function(e,t,i){var r=function(){Function.prototype.bind=Function.prototype.bind||function(e){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var t=Array.prototype.slice;var i=t.call(arguments,1);var r=this;var n=function(){};var s=function(){return r.apply(this instanceof n?this:e||window,i.concat(t.call(arguments)))};n.prototype=this.prototype;s.prototype=new n;return s};Object.assign=Object.assign||function(e){if(e===undefined||e===null){throw new TypeError("Cannot convert undefined or null to object")}var t=Object(e);for(var i=1;i<arguments.length;i++){var r=arguments[i];if(r!==undefined&&r!==null){for(var n in r){if(r.hasOwnProperty(n)){t[n]=r[n]}}}}return t};Object.create=Object.create||function(){var e=function(){};return function(t,i){if(t!==Object(t)&&t!==null){throw TypeError("Argument must be an object, or null")}e.prototype=t||{};var r=new e;e.prototype=null;if(i!==undefined){Object.defineProperties(r,i)}if(t===null){r.prototype=null}return r}}();Array.prototype.forEach=Array.prototype.forEach||function(e,t){if(typeof e!=="function"){throw new TypeError(e+" is not a function!")}var i=this.length;for(var r=0;r<i;r++){e.call(t,this[r],r,this)}};Array.isArray=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}};t.exports=r},{}],24:[function(e,t,i){var r=e("./object");var n=e("./chrono");var s=r.extend({constructor:function(e,t){this.callback=e;this.interval=t||5e3;this.isRunning=false;this._timer=null;this.chrono=new n},start:function(){this.isRunning=true;this._setTick()},stop:function(){this.isRunning=false;if(this._timer)clearTimeout(this._timer)},_setTick:function(){this.chrono.start();this._timer=setTimeout(function(){this.callback(this.chrono.stop());this._setTick()}.bind(this),this.interval)}});t.exports=s},{"./chrono":7,"./object":19}],25:[function(e,t,i){var r=e("./log");var n={stripProtocol:function(e){try{return e.replace(/^(.*?:\/\/|\/\/)/i,"")}catch(t){r.warn(t);return e}},addProtocol:function(e,t){try{if(t===true){return"https://"+e}else if(window.location.protocol.indexOf("http")===0){return"//"+e}else{return"http://"+e}}catch(e){r.warn(e);return"http://localhost/"}},parseNumber:function(e,t){if(!isNaN(e)&&e>=0&&e!==Infinity&&e!==-Infinity&&e!==null&&typeof e!=="undefined"){return e}else{return t}},listenAllEvents:function(e,t,i){try{if(r.logLevel<=r.Level.DEBUG){i=i||function(e){r.debug("Event: "+e.type)};var n=["canplay","buffering","waiting","ended","play","playing","pause","resume","error","abort","seek","seeking","seeked","stalled","dispose","loadeddata","loadstart"];if(t){if(t[0]===null){t.shift();n=t}else{n=n.concat(t)}}for(var s=0;s<n.length;s++){if(typeof e==="function"){e.call(window,n[s],i)}else if(e.on){e.on(n[s],i)}else if(e.addEventListener){e.addEventListener(n[s],i)}}}}catch(e){r.error(e)}},buildRenditionString:function(e,t,i){if(arguments.length===1){i=e;e=null;t=null}var r="";if(e&&t){r=e+"x"+t;if(i>0){r+="@"}}if(i<1){return r}else if(i<1e3){r+=Math.round(i)+"bps"}else if(i<1e6){i=Math.round(i/1e3);r+=i+"Kbps"}else{i=Math.round(i/1e4)/100;r+=i+"Mbps"}return r||null}};t.exports=n},{"./log":18}],26:[function(e,t,i){t.exports=e("../manifest.json").version},{"../manifest.json":2}],27:[function(e,t,i){var r=n;var n={};n.noConflict=function(){n=r;return this};n.VERSION=e("./version");n.polyfills=e("./polyfills");n.Object=e("./object");n.Emitter=e("./emitter");n.Util=e("./util");n.Chrono=e("./chrono");n.Timer=e("./timer");n.Log=e("./log");n.Log.loadLevelFromUrl();n.Request=e("./comm/request");n.Communication=e("./comm/communication");n.Transform=e("./comm/transform/transform");n.ViewTransform=e("./comm/transform/view");n.Nqs6Transform=e("./comm/transform/nqs6");n.ResourceTransform=e("./comm/transform/resource");n.CdnParser=e("./comm/transform/cdnparser");n.HlsParser=e("./comm/transform/hlsparser");n.Options=e("./plugin/options");n.Plugin=e("./plugin/plugin");n.RequestBuilder=e("./plugin/requestbuilder");n.PlayheadMonitor=e("./adapter/playheadmonitor");n.Adapter=e("./adapter/adapter");n.adapters={};t.exports=n},{"./adapter/adapter":3,"./adapter/playheadmonitor":6,"./chrono":7,"./comm/communication":8,"./comm/request":9,"./comm/transform/cdnparser":10,"./comm/transform/hlsparser":12,"./comm/transform/nqs6":13,"./comm/transform/resource":14,"./comm/transform/transform":15,"./comm/transform/view":16,"./emitter":17,"./log":18,"./object":19,"./plugin/options":20,"./plugin/plugin":21,"./plugin/requestbuilder":22,"./polyfills":23,"./timer":24,"./util":25,"./version":26}],28:[function(e,t,i){var r=e("youboralib");var n=e("../manifest.json");r.adapters.Videojs5=r.Adapter.extend({getVersion:function(){return n.version+"-videojs5"},getPlayhead:function(){if(this.player.absoluteTime){return this.player.absoluteTime()}else{return this.player.currentTime()}},getDuration:function(){if(this.player.mediainfo&&typeof this.player.mediainfo.duration!=="undefined"){return this.player.mediainfo.duration}else{return this.player.duration()}},getResource:function(){if(this.getTech().hls_){return this.getTech().hls_.url}else{return this.player.currentSrc()}},getTitle:function(){if(this.player.mediainfo&&this.player.mediainfo.name){return this.player.mediainfo.name}},getThroughput:function(){if(this.getTech().hls&&this.getTech().hls.bandwidth){return this.getTech().hls.bandwidth}},getBitrate:function(){if(this.getTech().hls){var e=this.getTech().hls.playlists.media();if(e&&e.attributes)return e.attributes.BANDWIDTH}else if(this.getTech().hls_){var t=this.getTech().hls_.levels[this.getTech().hls_.currentLevel];if(t&&t.bitrate)return t.bitrate}},getRendition:function(){if(this.getTech().hls){var e=this.getTech().hls.playlists.media();if(e&&e.attributes){var t=e.attributes;if(t.NAME){return t.NAME}else if(t.RESOLUTION){return r.Util.buildRenditionString(t.RESOLUTION.width,t.RESOLUTION.height,t.BANDWIDTH)}else{return r.Util.buildRenditionString(t.BANDWIDTH)}}}else if(this.getTech().hls_){var i=this.getTech().hls_.levels[this.getTech().hls_.currentLevel];if(i&&i.name){return i.name}else{return r.Util.buildRenditionString(i.width,i.height,i.bitrate)}}},getPlayerName:function(){var e="videojs5";if(this.getTech().hls)e+="-hls";if(this.getTech().hls_)e+="-hlsjs";if(this.player.mediainfo)e+="-bcove";if(this.player.ima||this.player.ima3)e+="-ima";if(this.player.FreeWheelPlugin)e+="-fw";if(this.player.onceux)this.pluginName+="-oux";return e},getPlayerVersion:function(){var e=this.getPlayerName();if(videojs.VERSION)e+=" "+videojs.VERSION;return e},getTech:function(){return this.player.tech({IWillNotUseThisInPlugins:true})},registerListeners:function(){r.Util.listenAllEvents(this.player,["adstart","adend","adskip","adsready","adserror","dispose"]);this.monitorPlayhead(true,false);this.player.on("loadstart",this.loadstartListener.bind(this));this.player.on("play",this.playListener.bind(this));this.player.on("timeupdate",this.timeupdateListener.bind(this));this.player.on("pause",this.pauseListener.bind(this));this.player.on("playing",this.playingListener.bind(this));this.player.on("abort",this.abortListener.bind(this));this.player.on("ended",this.endedListener.bind(this));this.player.on("dispose",this.disposeListener.bind(this));this.player.on("seeking",this.seekingListener.bind(this));this.player.on("seeked",this.seekedListener.bind(this));this.player.on("error",this.errorListener.bind(this))},loadstartListener:function(e){r.Log.notice("Player detected "+this.getPlayerName());if(this.player.autoplay())this.fireStart()},playListener:function(e){this.fireStart()},timeupdateListener:function(e){if(this.getPlayhead()>.1){this.fireJoin();if(this.lastSeekPlayhead&&this.lastSeekPlayhead!==this.getPlayhead()){this.fireSeekEnd();this.lastSeekPlayhead=false}}},pauseListener:function(e){this.firePause()},playingListener:function(e){this.fireResume()},abortListener:function(e){this.fireStop()},endedListener:function(e){this.fireStop()},disposeListener:function(e){this.fireStop()},seekingListener:function(e){this.fireSeekBegin()},seekedListener:function(e){this.lastSeekPlayhead=this.getPlayhead()},errorListener:function(e){if(this.player.error&&this.player.error()){this.fireError(this.player.error().code,this.player.error().message)}},unregisterListeners:function(){this.monitor.stop();this.player.off("loadstart",this.loadstartListener);this.player.off("play",this.playListener);this.player.off("playing",this.playingListener);this.player.off("pause",this.pauseListener);this.player.off("abort",this.abortListener);this.player.off("ended",this.endedListener);this.player.off("dispose",this.disposeListener);this.player.off("seeking",this.seekingListener);this.player.off("seeked",this.seekedListener);this.player.off("timeupdate",this.timeupdateListener);this.player.off("error",this.errorListener)}});t.exports=r.adapters.Videojs5},{"../manifest.json":1,youboralib:27}],29:[function(e,t,i){var r=e("youboralib");e("./adapter");t.exports=r},{"./adapter":28,youboralib:27}]},{},[29])(29)});
//# sourceMappingURL=sp.min.js.map
